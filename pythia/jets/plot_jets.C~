{
  gROOT->LoadMacro("~/macros/utils.C");
  set_legend_font(62,0.05);

  Char_t *fnames[]={"output/pythia_jets_5_15_all.root","output/pythia_jets_15_25_all.root","output/pythia_jets_25_35_all.root"};
  Float_t pthard[]={5,15,25,35};

  const Int_t do_scaling = 1;

  Int_t nfiles = sizeof(fnames)/sizeof(Char_t*);
  cout << nfiles << endl;
 
  TCanvas *c1= new TCanvas("c1","c1: pt spectra",1000,600);
  c1->Divide(2,1);

  TCanvas *c2 = new TCanvas("c2","c2: frag funcs",800,800);
  c2->Divide(2,2);
  TLatex *ltx = new TLatex;
  ltx->SetNDC();

  Float_t ptjetmin = 15;
  Float_t ptjetmax = 20;

  THStack *hpions = new THStack("hpions","pions in jets");
  THStack *hkaons = new THStack("hkaons","kaons in jets");
  THStack *hprotons = new THStack("hprotons","protons in jets");
  THStack *hdzero = new THStack("hdzero","DZero in jets");


  for (Int_t ifile = 0; ifile < nfiles; ifile++) {
    TFile *fin = new TFile(fnames[ifile]);
    cout << "file " << fnames[ifile] << " xsec " << hXSec->GetBinContent(1) << " events " << hNEvent->GetBinContent(1) << endl;
    Float_t scale = hXSec->GetBinContent(1)/hNEvent->GetBinContent(1);

    c1->cd(1);
    gPad->SetLogy();
    if (do_scaling) {
      hPtPion->Sumw2();
      hPtPion->Scale(scale);
    }
    if (ifile == 0) {      
      hPtPion->Draw();
      gPad->Update();
      ltx->DrawLatex(ndc_x(0.6),ndc_y(0.86),"p_{T,hard}");
    }
    else {
      hPtPion->SetLineColor(1+ifile);
      hPtPion->SetMarkerColor(1+ifile);
      hPtPion->Draw("same");
    }

    hptp = hPtPion;

    gPad->Update();
    draw_legend_l(0.6,0.8,hptp,Form("%.0f - %.0f",pthard[ifile],pthard[ifile+1]),ifile);

    c1->cd(2);
    gPad->SetLogy();
    px = hJetPtEtaPhi->Project3D(Form("x_%d"));
    px = new TH1D(*((TH1D*)px));
    px->SetName(Form("px_%d"));
    if (do_scaling) {
      px->Sumw2();
      px->Scale(scale);
    }
    if (ifile == 0)
      px->DrawCopy();
    else {
      px->SetLineColor(1+ifile);
      px->SetMarkerColor(1+ifile);
      px->DrawCopy("same");
    }


    Int_t minbin = hPtJetPtPion->GetXaxis()->FindBin(ptjetmin+0.0001);
    Int_t maxbin = hPtJetPtPion->GetXaxis()->FindBin(ptjetmax-0.0001);

    hpy = hPtJetPtPion->ProjectionY(Form("pion_%d",ifile),minbin,maxbin);
    if (do_scaling) {
      hpy->Sumw2();
      hpy->Scale(scale);
    }
    hpy->SetLineColor(1+ifile);
    hpy->SetMarkerColor(1+ifile);
    hpions->Add(hpy);

    hpy = hPtJetPtKaon->ProjectionY(Form("kaon_%d",ifile),minbin,maxbin);
    if (do_scaling) {
      hpy->Sumw2();
      hpy->Scale(scale);
    }
    hpy->SetLineColor(1+ifile);
    hpy->SetMarkerColor(1+ifile);
    hkaons->Add(hpy);

    hpy = hPtJetPtProton->ProjectionY(Form("proton_%d",ifile),minbin,maxbin);
    if (do_scaling) {
      hpy->Sumw2();
      hpy->Scale(scale);
    }
    hpy->SetLineColor(1+ifile);
    hpy->SetMarkerColor(1+ifile);
    hprotons->Add(hpy);

    hpy = hPtJetPtD->ProjectionY(Form("dzero_%d",ifile),minbin,maxbin);
    if (do_scaling) {
      hpy->Sumw2();
      hpy->Scale(scale);
    }
    hpy->SetLineColor(1+ifile);
    hpy->SetMarkerColor(1+ifile);
    hdzero->Add(hpy);
  }

  c2->cd(1);
  gPad->SetLogy();
  hpions->Draw("nostack");
  ltx->DrawLatex(0.5,0.8,Form("%.0f < p_{T,jet} < %.f GeV",ptjetmin,ptjetmax));
  ltx->DrawLatex(0.7,0.7,"#pi^{#pm}");

  c2->cd(2);
  gPad->SetLogy();

  hkaons->Draw("nostack");
  ltx->DrawLatex(0.7,0.8,"K^{#pm}");

  c2->cd(3);
  gPad->SetLogy();
  hprotons->Draw("nostack");
  ltx->DrawLatex(0.7,0.8,"p+#bar{p}");

  c2->cd(4);
  gPad->SetLogy();
  hdzero->Draw("nostack");
  ltx->DrawLatex(0.7,0.8,"D^{0}+#bar{D}^{0}");


}
